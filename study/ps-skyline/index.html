<!DOCTYPE html>
<!--
    So Simple Jekyll Theme 3.2.0
    Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/so-simple-theme/blob/master/LICENSE
--><html lang="en-US" class="no-js">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  

  
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Problem Solving: skyline | KC blog</title>
<meta name="generator" content="Jekyll v3.9.5">
<meta property="og:title" content="Problem Solving: skyline">
<meta property="og:locale" content="en_US">
<meta name="description" content="이전에 직장에서 computational geometry study를 가진적이 있다. 그때 알게된 문제인데 skyline problem이라고 하는 유명한 문제가 leetcode에도 있어서 이 문제를 풀고 개선하려고 정리했던 적이 있다. 정리해두고 잊고 있었는데, 블로그에 올려두려 한다.">
<meta property="og:description" content="이전에 직장에서 computational geometry study를 가진적이 있다. 그때 알게된 문제인데 skyline problem이라고 하는 유명한 문제가 leetcode에도 있어서 이 문제를 풀고 개선하려고 정리했던 적이 있다. 정리해두고 잊고 있었는데, 블로그에 올려두려 한다.">
<link rel="canonical" href="https://keechang-choi.github.io/study/ps-skyline/">
<meta property="og:url" content="https://keechang-choi.github.io/study/ps-skyline/">
<meta property="og:site_name" content="KC blog">
<meta property="og:image" content="https://keechang-choi.github.io/images/ps-skyline/ps-skyline1.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-02-20T00:00:00+09:00">
<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:image" content="https://keechang-choi.github.io/images/ps-skyline/ps-skyline1.png">
<meta property="twitter:title" content="Problem Solving: skyline">
<meta name="twitter:site" content="@">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-02-20T00:00:00+09:00","datePublished":"2024-02-20T00:00:00+09:00","description":"이전에 직장에서 computational geometry study를 가진적이 있다. 그때 알게된 문제인데 skyline problem이라고 하는 유명한 문제가 leetcode에도 있어서 이 문제를 풀고 개선하려고 정리했던 적이 있다. 정리해두고 잊고 있었는데, 블로그에 올려두려 한다.","headline":"Problem Solving: skyline","image":{"thumbnail":"/images/ps-skyline/ps-skyline1.png","url":"https://keechang-choi.github.io/images/ps-skyline/ps-skyline1.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://keechang-choi.github.io/study/ps-skyline/"},"url":"https://keechang-choi.github.io/study/ps-skyline/"}</script>
<!-- End Jekyll SEO tag -->


  

  <script>
    /* Cut the mustard */
    if ('querySelector' in document && 'addEventListener' in window) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link href="/assets/leaf-48.ico" rel="shortcut icon" type="image/vnd.microsoft.icon">

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/skins/default.css">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,700,700i|Lora:400,400i,700,700i">
  <link rel="alternate" type="application/atom+xml" title="KC blog" href="/atom.xml">
<!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

</head>

  <body class="layout--post  problem-solving-skyline">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    
  <div class="navigation-wrapper">
    <a href="#menu-toggle" id="menu-toggle">Menu</a>
    <nav id="primary-nav" class="site-nav animated drop">
      <ul>
<li><a href="/">Home</a></li>
<li><a href="/posts/">Posts</a></li>
<li><a href="/categories/">Categories</a></li>
<li><a href="/tags/">Tags</a></li>
<li><a href="/search/">Search</a></li>
</ul>
    </nav>
  </div>
<!-- /.navigation-wrapper -->


    <header class="masthead">
  <div class="wrap">
    
    
    
  </div>
</header><!-- /.masthead -->


    <main id="main" class="main-content" aria-label="Content">
  <article class="h-entry">
    
  
  
  

  <div class="page-image">
    <img src="/images/ps-skyline/ps-skyline1.png" class="entry-feature-image u-photo" alt="Problem Solving: skyline" style="margin-top: 0;">
    
  </div>


    <div class="page-wrapper">
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <header class="page-header">
        
        
        <h1 id="page-title" class="page-title p-name">Problem Solving: skyline
</h1>
        
      </header>

      <div class="page-sidebar">
        <div class="page-author h-card p-author">
<div class="author-info">
<ul class="author-links"><li class="author-link">
            <a class="u-url" rel="me" href=""><i class="fas fa-link fa-lg" title=""></i></a>
          </li></ul>
    <time class="page-date dt-published" datetime="2024-02-20T00:00:00+09:00"><a class="u-url" href="">February 20, 2024</a>
</time>

  </div>
</div>

        
  <h3 class="page-taxonomies-title">Categories</h3>
  
  <ul class="page-taxonomies">
<li class="page-taxonomy"><a class="p-category" href="/categories/#study" title="Pages filed under study">study</a></li>
  </ul>


        
  <h3 class="page-taxonomies-title">Tags</h3>
  
  <ul class="page-taxonomies">
<li class="page-taxonomy"><a href="/tags/#computational-geometry" title="Pages tagged computational geometry" rel="tag">computational geometry</a></li>
<li class="page-taxonomy"><a href="/tags/#ps" title="Pages tagged ps" rel="tag">ps</a></li>
  </ul>


      </div>

      <div class="page-content">
        <div class="e-content">
          <p>이전에 직장에서 computational geometry study를 가진적이 있다.<br>
그때 알게된 문제인데 skyline problem이라고 하는 유명한 문제가 leetcode에도 있어서 이 문제를 풀고 개선하려고 정리했던 적이 있다.<br>
정리해두고 잊고 있었는데, 블로그에 올려두려 한다.</p>

<ul>
  <li><a href="#%EB%AC%B8%EC%A0%9C-%EC%84%A4%EB%AA%85">문제 설명</a></li>
  <li><a href="#%EA%B8%B0%EC%A1%B4-%ED%95%B4%EB%B2%95">기존 해법</a></li>
  <li><a href="#%EA%B0%9C%EC%84%A0-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98">개선 알고리즘</a></li>
  <li><a href="#%EC%95%84%EC%9D%B4%EB%94%94%EC%96%B4">아이디어</a></li>
  <li><a href="#%EA%B5%AC%ED%98%84">구현</a></li>
  <li><a href="#%EA%B2%80%EC%A6%9D-%EB%B0%8F-%EC%8B%9C%EA%B0%81%ED%99%94">검증 및 시각화</a></li>
  <li><a href="#%EC%BD%94%EB%93%9C-%EC%9E%90%EB%A3%8C">코드 자료</a></li>
  <li><a href="#104">10^4</a></li>
</ul>

<hr>

<h1 id="문제-설명">문제 설명</h1>

<blockquote>
  <p><a href="https://leetcode.com/problems/the-skyline-problem/">https://leetcode.com/problems/the-skyline-problem/</a></p>
</blockquote>

<p>먼저 skyline problem 문제 정의는 위 leetcode에서 명확히 알 수 있다. 간단하게는 빌딩이 여러개 겹쳐있을때, 하늘의 선이 어떻게 될지 찾으라는 문제인데 시간 복잡도를 줄이는게 핵심인 문제다.</p>

<h1 id="기존-해법">기존 해법</h1>

<p>보통 PS 에서 요구되는 입력 범위와 알고리즘은 O(n log n)을 요구한다.<br>
대부분의 해법을 찾아보면 priority queue를 활용한 방법이나, divide and merge 로 풀 수 있다.</p>

<ul>
  <li>segments에는 건물의 x 값과 건물 index를 pair로 넣고 정렬한다. (시작점과 끝점의 x 모두)</li>
  <li>priority queue에 높이와 건물이 끝나는 x 좌표를 같이 저장한다. (이때  우선순위는 높이, x좌표 큰 순)</li>
  <li>x 순으로 segment를 도는 loop.
    <ul>
      <li>현재 seg에 저장된 x 값이 현재 event x와 같을 동안 다음 seg로 반복한다. (같은 x 좌표에 여러 building이 겹칠때)
        <ul>
          <li>현재 seg에 저장된 건물의 시작 x값이 현재 event x와 같으면 높이와 끝 x 값을 pq에 추가한다.</li>
        </ul>
      </li>
      <li>pq에 들어있는 top부터 이미 event x 가 건물의 끝점을 지나간 것들은 pq에서 pop</li>
      <li>pq의 top에서 현재 높이를 얻는다. (이때 pq가 비어있으면 0이 되도록 설정)</li>
      <li>이 높이가 이미 skyline의 마지막 값과 다른 경우만 event x 와 그 높이를 추가해준다. (같으면 이어져야함)</li>
    </ul>
  </li>
</ul>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// find skyline given building segments in O(n log n)</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">GetSkylineSlow</span><span class="p">(</span>
      <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&amp;</span> <span class="n">buildings</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">skyline</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">segs</span><span class="p">;</span>
    <span class="n">segs</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">buildings</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">buildings</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">buildings</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">segs</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">});</span>
      <span class="n">segs</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">(</span><span class="n">segs</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">segs</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

    <span class="n">std</span><span class="o">::</span><span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">pq</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">seg_idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">seg_idx</span> <span class="o">&lt;</span> <span class="n">segs</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">cur_x</span><span class="p">;</span>
      <span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">cur_x</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ignore</span><span class="p">)</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">];</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">seg_idx</span> <span class="o">&lt;</span> <span class="n">segs</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">cur_x</span> <span class="o">==</span> <span class="n">segs</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">].</span><span class="n">first</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">building_idx</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ignore</span><span class="p">,</span> <span class="n">building_idx</span><span class="p">)</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">];</span>
        <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">buildings</span><span class="p">[</span><span class="n">building_idx</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">cur_x</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">pq</span><span class="p">.</span><span class="n">push</span><span class="p">({</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]});</span>
        <span class="p">}</span>
        <span class="n">seg_idx</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// remove immediately as it ends</span>
      <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">pq</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">pq</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">second</span> <span class="o">&lt;=</span> <span class="n">cur_x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pq</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="kt">int</span> <span class="n">cur_height</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pq</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">cur_height</span> <span class="o">=</span> <span class="n">pq</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">first</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">skyline</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="n">skyline</span><span class="p">.</span><span class="n">back</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cur_height</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">skyline</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">cur_x</span><span class="p">,</span> <span class="n">cur_height</span><span class="p">});</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">skyline</span><span class="p">;</span>
  <span class="p">}</span>

</code></pre></div></div>

<p>다음은 고려할 corner case등을 생각한 과정이다.</p>

<p><img src="/images/ps-skyline/ps-skyline2.png" alt="image"></p>

<h1 id="개선-알고리즘">개선 알고리즘</h1>

<p>이 문제를 시간복잡도 O(n log h)에 풀수 있다는 정보를 study중 알게되었는데, 이때 h는 output으로 나오는 skyline의 point 수이다. 이런 알고리즘을 <a href="https://en.wikipedia.org/wiki/Output-sensitive_algorithm">output-sensitive</a> 알고리즘 이라고 하는데, 계산기하학 분야에서 자주 나온다.<br>
output의 수가 적게 예상되는 상황에서 효율적인 방식인데, skyline problem도 빌딩의 수 n이 매우 커지면 겹치는 부분들로 인해 최종 skyline의 수는 적을것으로 예상할만한 상황이다.</p>

<h1 id="아이디어">아이디어</h1>

<p>이 output-sensitive한 알고리즘의 대표적인 방식으로 convex hull 을 찾는 <a href="https://en.wikipedia.org/wiki/Chan%27s_algorithm">Chan’s algorithm</a> 이 있는데, 이와 유사한 아이디어로 문제를 접근하기로 했다.</p>

<ul>
  <li>최종 skyline의 수를 h라고 하고, 이 값은 알 수 없으므로 먼저 h*라고 guess한다.</li>
  <li>그다음 각 building을 h*개씩 묶어서 k개의 그룹을 만든다.</li>
  <li>각 그룹에서 skyline을 찾는다. (이전의 우선순위 큐 방식 사용)
    <ul>
      <li>O(k x (h* log h<em>)) = O(n log h</em>)</li>
    </ul>
  </li>
  <li>각 그룹에서 ray query를 할 수 있는 구조를 구축한다.
    <ul>
      <li>O(k x (h* log h*))</li>
    </ul>
  </li>
  <li>각 그룹의 skyline을 하나로 합친다.
    <ul>
      <li>시작점에서 모든 k개의 그룹으로 query를 날려서 가장 가까운 segment로 이동한다.
        <ul>
          <li>O(k x log h*)</li>
        </ul>
      </li>
      <li>이 query 후 이동 과정을 한번 하면 최종 skyline의 점 하나를 얻으므로,  h 번 반복하면 정답을 얻어야 한다. guess했던 h*가 h 보다 크거나 같다면 어쨌든 정답을 찾을 수 있다.
        <ul>
          <li>O(n log h*)</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>이제 이 h*를 작은 값에서부터 늘리면서 정답을 찾을 수 있을때까지 늘리면 된다.
    <ul>
      <li>이 늘리는 방식은 2^(2^i) 형태로 늘리는데, 이렇게 늘려야 모든 합을 계산했을 때, O(n log h)를 달성할 수 있다.</li>
    </ul>
  </li>
</ul>

<p><img src="/images/ps-skyline/ps-skyline3.png" alt="image"></p>

<p>이 query는 다음과 같이 한 점에서 수평선으로 ray를 쐈을 때, 어떤 vertical segment와 먼저 만나는지 반환해야하는데, O(log n)의 시간복잡도를 보장해야하고, 구축할때 O(n log n)의 시간복잡도를 만족해야 한다.</p>

<p>range tree나, kd tree 등 여러 tree 구조의 데이터를 구축해야 탐색 시 시간복잡도를 만족할 것으로 생각하고 조사해봤다.<br>
결국 선택한 방식은 y좌표로 한번, x좌표로 한번 두개의 binary search를 하도록 구성하는 방식인데, 이를 구성할 때 시간을 줄이기 위해 <a href="https://en.wikipedia.org/wiki/Fractional_cascading">fractional cascading</a> 기법을 사용했다.</p>

<p>query 과정을 나타낸 모식도이며 세부 알고리즘은 구현 코드와 주석으로 대체하려한다.
<img src="/images/ps-skyline/ps-skyline4.png" alt="image"></p>

<h1 id="구현">구현</h1>

<p><img src="/images/ps-skyline/ps-skyline5.png" alt="image"></p>

<p>초기 구현 결과로 복잡한 예시를 넣어봤다. 오류가 몇가지 있었는데 수정한 내용이다.</p>
<ul>
  <li>next sub group point exist 중 drop 조건</li>
  <li>그후 prev로 drop하기 전에, current next y로 self drop이 더 높으면 drop하지 않도록 조건을 변경</li>
</ul>

<p>해당 이슈를 수정한 후 원하는 결과를 얻었다.<br>
<img src="/images/ps-skyline/ps-skyline6.png" alt="image"></p>

<p>보기 편하게 20개 건물로 확인한 결과이다.</p>

<p><img src="/images/ps-skyline/ps-skyline9.png" alt="image"></p>

<p>구현과정에서는 테스트 케이스를 하나씩 추가해가며 각 기능의 구현완료를 확인하고 넘어갔다.</p>

<h1 id="검증-및-시각화">검증 및 시각화</h1>

<p>가장 먼저 시각화 코드를 작성해서 눈으로 결과의 오류를 확인하고 수정할 부분을 건드렸다.<br>
그 이후 각 부분별로 실행시간을 확인했다.<br>
<img src="/images/ps-skyline/ps-skyline8.png" alt="image"></p>

<ul>
  <li>preprocess는 O(n)이 예상되는 부분인데 조금 오래걸린것으로 보고, copy 최적화로 절반 가량 줄였다.</li>
  <li>subgp skyline 시간 총합</li>
  <li>각 query tree 구축 시간
    <ul>
      <li>이부분이 가장 시간을 많이 쓰고 있어서 최적화의 여지가 있지만 남겨두었다.</li>
    </ul>
  </li>
  <li>h* loop의 각각 query 시간</li>
</ul>

<p><img src="/images/ps-skyline/ps-skyline7.png" alt="image"></p>

<p>이후에는 n을 키워가며 기존의 알고리즘과 제안한 알고리즘의 시간이 얼마나 걸리는지 측정했다.<br>
n의 범위가 작을때는 priority queue 방식이 더 빨랐지만, n이 10^6을 넘어가면서부터는 개선된 시간을 보였다. 이 n은 최적화를 통해 더 줄일 수 있을 것으로 판단했다.<br>
하지만 이런 asymptotic analysis 자체가 practical 한 측면 보다는 theoretical한 분석위주이기 때문에, 실제 알고리즘에는 불필요한 constant term을 줄일필요가 있을 것이다. 참고로 leetcode에서 제공되는 n의 최대값은 10^4으로 기존 알고리즘이 더 나은 성능을 보이는데, 여러 이론상 빠른 알고리즘들도 구현상 복작도나, n이 작은 경우 느려서 쓰이지 않는 케이스가 많이 있기때문에 큰 문제는 아니라고 생각했다.</p>

<h1 id="코드-자료">코드 자료</h1>

<details>
<summary>전체 알고리즘과 테스트 코드, 프로파일링 코드</summary>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;random&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;tuple&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unordered_map&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span>
<span class="k">class</span> <span class="nc">Node</span> <span class="p">{</span>
 <span class="nl">public:</span>
  <span class="n">Node</span><span class="o">*</span> <span class="n">left</span><span class="p">;</span>
  <span class="n">Node</span><span class="o">*</span> <span class="n">right</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">y_med</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">x_sorted_idx</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">left_x_cascading_map</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">right_x_cascading_map</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">left_x_cascading_map_inverse</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">right_x_cascading_map_inverse</span><span class="p">;</span>

  <span class="n">Node</span><span class="p">(</span><span class="kt">int</span> <span class="n">y_med_</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">x_sorted_idx_</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">y_med</span><span class="p">(</span><span class="n">y_med_</span><span class="p">),</span> <span class="n">x_sorted_idx</span><span class="p">(</span><span class="n">x_sorted_idx_</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">left</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
    <span class="n">right</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Tree</span> <span class="p">{</span>
 <span class="nl">public:</span>
  <span class="n">Node</span><span class="o">*</span> <span class="n">root</span><span class="p">;</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&amp;</span> <span class="n">pts</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">x_sorted_idx</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">y_sorted_idx</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">idx_to_y_order</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">td1</span><span class="p">,</span> <span class="n">td2</span><span class="p">,</span> <span class="n">td3</span><span class="p">,</span> <span class="n">td4</span><span class="p">,</span> <span class="n">td5</span><span class="p">,</span> <span class="n">td6</span><span class="p">;</span>
  <span class="n">Tree</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&amp;</span> <span class="n">pts_</span><span class="p">)</span> <span class="o">:</span> <span class="n">pts</span><span class="p">(</span><span class="n">pts_</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// TODO: remove O(n) copys using only sort.</span>
    <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">begin</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">end</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">tp0</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">tp1</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">tp2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">time_diff</span><span class="p">;</span>

    <span class="n">begin</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

    <span class="c1">// std::vector&lt;std::tuple&lt;int, int, int&gt;&gt; indexed_xy;</span>
    <span class="c1">// indexed_xy.reserve(pts_.size());</span>
    <span class="c1">// for (int i = 0; i &lt; pts.size(); i++) {</span>
    <span class="c1">//   indexed_xy.emplace_back(i, pts[i][0], pts[i][1]);</span>
    <span class="c1">// }</span>

    <span class="c1">// std::sort(indexed_xy.begin(), indexed_xy.end(),</span>
    <span class="c1">//           [](const auto&amp; a, const auto&amp; b) {</span>
    <span class="c1">//             int a_x;</span>
    <span class="c1">//             std::tie(std::ignore, a_x, std::ignore) = a;</span>
    <span class="c1">//             int b_x;</span>
    <span class="c1">//             std::tie(std::ignore, b_x, std::ignore) = b;</span>
    <span class="c1">//             return a_x &lt; b_x;</span>
    <span class="c1">//           });</span>
    <span class="c1">// x_sorted_idx.reserve(pts_.size());</span>
    <span class="c1">// for (const auto&amp; item : indexed_xy) {</span>
    <span class="c1">//   int idx;</span>
    <span class="c1">//   std::tie(idx, std::ignore, std::ignore) = item;</span>
    <span class="c1">//   x_sorted_idx.push_back(idx);</span>
    <span class="c1">// }</span>
    <span class="n">x_sorted_idx</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">pts_</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
    <span class="c1">// y_sorted_idx.reserve(pts_.size());</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pts_</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">x_sorted_idx</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
      <span class="c1">// y_sorted_idx.push_back(i);</span>
    <span class="p">}</span>

    <span class="c1">// x_sorted_idx.resize(pts_.size());</span>
    <span class="c1">// std::iota(x_sorted_idx.begin(), x_sorted_idx.end(), 0);</span>
    <span class="n">tp0</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">y_sorted_idx</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">pts_</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pts_</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">y_sorted_idx</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">tp1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

    <span class="n">std</span><span class="o">::</span><span class="n">stable_sort</span><span class="p">(</span>
        <span class="n">y_sorted_idx</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">y_sorted_idx</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
        <span class="p">[</span><span class="o">&amp;</span><span class="n">pts_</span><span class="p">](</span><span class="kt">int</span> <span class="n">i1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">pts_</span><span class="p">[</span><span class="n">i1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">pts_</span><span class="p">[</span><span class="n">i2</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span> <span class="p">});</span>

    <span class="c1">// std::stable_sort(indexed_xy.begin(), indexed_xy.end(),</span>
    <span class="c1">//                  [](const auto&amp; a, const auto&amp; b) {</span>
    <span class="c1">//                    int a_y;</span>
    <span class="c1">//                    std::tie(std::ignore, std::ignore, a_y) = a;</span>
    <span class="c1">//                    int b_y;</span>
    <span class="c1">//                    std::tie(std::ignore, std::ignore, b_y) = b;</span>
    <span class="c1">//                    return a_y &lt; b_y;</span>
    <span class="c1">//                  });</span>
    <span class="n">tp2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

    <span class="c1">// y_sorted_idx.reserve(pts_.size());</span>
    <span class="c1">// idx_to_y_order.resize(indexed_xy.size());</span>

    <span class="c1">// for (int i = 0; i &lt; indexed_xy.size(); i++) {</span>
    <span class="c1">//   int idx;</span>
    <span class="c1">//   std::tie(idx, std::ignore, std::ignore) = indexed_xy[i];</span>
    <span class="c1">//   idx_to_y_order[idx] = i;</span>
    <span class="c1">//   y_sorted_idx.push_back(idx);</span>
    <span class="c1">// }</span>

    <span class="n">idx_to_y_order</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">y_sorted_idx</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">y_sorted_idx</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">idx_to_y_order</span><span class="p">[</span><span class="n">y_sorted_idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">td1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">begin</span><span class="p">)</span>
              <span class="p">.</span><span class="n">count</span><span class="p">();</span>

    <span class="n">td3</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">tp0</span> <span class="o">-</span> <span class="n">begin</span><span class="p">)</span>
              <span class="p">.</span><span class="n">count</span><span class="p">();</span>
    <span class="n">td4</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">tp1</span> <span class="o">-</span> <span class="n">tp0</span><span class="p">)</span>
              <span class="p">.</span><span class="n">count</span><span class="p">();</span>
    <span class="n">td5</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">tp2</span> <span class="o">-</span> <span class="n">tp1</span><span class="p">)</span>
              <span class="p">.</span><span class="n">count</span><span class="p">();</span>
    <span class="n">td6</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">tp2</span><span class="p">)</span>
              <span class="p">.</span><span class="n">count</span><span class="p">();</span>

    <span class="n">begin</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">ConstructTree</span><span class="p">(</span><span class="n">x_sorted_idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pts</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">td2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">begin</span><span class="p">)</span>
              <span class="p">.</span><span class="n">count</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">Node</span><span class="o">*</span> <span class="n">ConstructTree</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">x_sorted_idx_</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y_idx_left</span><span class="p">,</span>
                      <span class="kt">int</span> <span class="n">y_idx_right</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// TODO: remove x_sorted_idx_ parameter using y indices</span>
    <span class="kt">int</span> <span class="n">y_idx_med</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_idx_left</span> <span class="o">+</span> <span class="n">y_idx_right</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y_med</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">y_sorted_idx</span><span class="p">[</span><span class="n">y_idx_med</span><span class="p">]][</span><span class="mi">1</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">x_sorted_idx_</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="c1">// std::cout &lt;&lt; "Tree Construction [" &lt;&lt; y_idx_left &lt;&lt; " ~ " &lt;&lt; y_idx_right</span>
    <span class="c1">//           &lt;&lt; "]" &lt;&lt; std::endl;</span>
    <span class="c1">// std::cout &lt;&lt; "y med: " &lt;&lt; y_med &lt;&lt; std::endl;</span>
    <span class="c1">// for (const auto&amp; idx : x_sorted_idx_) {</span>
    <span class="c1">//   std::cout &lt;&lt; "(" &lt;&lt; pts[idx][0] &lt;&lt; ", " &lt;&lt; pts[idx][1] &lt;&lt; ") - ";</span>
    <span class="c1">// }</span>
    <span class="c1">// std::cout &lt;&lt; std::endl;</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">node</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="p">(</span><span class="n">y_med</span><span class="p">,</span> <span class="n">x_sorted_idx_</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">y_idx_left</span> <span class="o">==</span> <span class="n">y_idx_right</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">node</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">x_sorted_idx_left</span><span class="p">;</span>
    <span class="n">x_sorted_idx_left</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">x_sorted_idx_right</span><span class="p">;</span>
    <span class="n">x_sorted_idx_right</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">left_x_cascading_map</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">left_x_cascading_map</span><span class="p">;</span>
    <span class="n">left_x_cascading_map</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">right_x_cascading_map</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right_x_cascading_map</span><span class="p">;</span>
    <span class="n">right_x_cascading_map</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">left_x_cascading_map_inverse</span> <span class="o">=</span>
        <span class="n">node</span><span class="o">-&gt;</span><span class="n">left_x_cascading_map_inverse</span><span class="p">;</span>
    <span class="n">left_x_cascading_map_inverse</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">right_x_cascading_map_inverse</span> <span class="o">=</span>
        <span class="n">node</span><span class="o">-&gt;</span><span class="n">right_x_cascading_map_inverse</span><span class="p">;</span>
    <span class="n">right_x_cascading_map_inverse</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">left_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">right_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">left_cnt_inverse</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">right_cnt_inverse</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="c1">// 0~size</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x_sorted_idx_</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">left_x_cascading_map</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">left_cnt</span><span class="p">);</span>
      <span class="n">right_x_cascading_map</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">right_cnt</span><span class="p">);</span>

      <span class="kt">int</span> <span class="n">y_order_i</span> <span class="o">=</span> <span class="n">idx_to_y_order</span><span class="p">[</span><span class="n">x_sorted_idx_</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">y_order_i</span> <span class="o">&lt;</span> <span class="n">y_idx_med</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">x_sorted_idx_left</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">x_sorted_idx_</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">left_cnt</span><span class="o">++</span><span class="p">;</span>
        <span class="n">left_cnt_inverse</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">x_sorted_idx_right</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">x_sorted_idx_</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">right_cnt</span><span class="o">++</span><span class="p">;</span>
        <span class="n">right_cnt_inverse</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">left_x_cascading_map_inverse</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">left_cnt_inverse</span><span class="p">);</span>
      <span class="n">right_x_cascading_map_inverse</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">right_cnt_inverse</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">left_node</span> <span class="o">=</span>
        <span class="n">ConstructTree</span><span class="p">(</span><span class="n">x_sorted_idx_left</span><span class="p">,</span> <span class="n">y_idx_left</span><span class="p">,</span> <span class="n">y_idx_med</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">right_node</span> <span class="o">=</span>
        <span class="n">ConstructTree</span><span class="p">(</span><span class="n">x_sorted_idx_right</span><span class="p">,</span> <span class="n">y_idx_med</span><span class="p">,</span> <span class="n">y_idx_right</span><span class="p">);</span>

    <span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">=</span> <span class="n">left_node</span><span class="p">;</span>
    <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">=</span> <span class="n">right_node</span><span class="p">;</span>
    <span class="c1">// node-&gt;left_x_cascading_map = left_x_cascading_map;</span>
    <span class="c1">// node-&gt;right_x_cascading_map = right_x_cascading_map;</span>
    <span class="c1">// node-&gt;left_x_cascading_map_inverse = left_x_cascading_map_inverse;</span>
    <span class="c1">// node-&gt;right_x_cascading_map_inverse = right_x_cascading_map_inverse;</span>

    <span class="k">return</span> <span class="n">node</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">QueryRight</span><span class="p">(</span><span class="kt">int</span> <span class="n">qx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qy</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">node</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">bound_x_sorted_idx</span> <span class="o">=</span> <span class="n">LowerBound</span><span class="p">(</span><span class="n">x_sorted_idx</span><span class="p">,</span> <span class="n">qx</span><span class="p">);</span>
    <span class="c1">// if (bound_x_sorted_idx &lt; x_sorted_idx.size() &amp;&amp;</span>
    <span class="c1">//     x_sorted_idx[bound_x_sorted_idx] == qx) {</span>
    <span class="c1">//   bound_x_sorted_idx = UpperBound(x_sorted_idx, qx) + 1;</span>
    <span class="c1">// }</span>
    <span class="kt">int</span> <span class="n">closest_right_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">!=</span> <span class="nb">nullptr</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">!=</span> <span class="nb">nullptr</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//   std::cout &lt;&lt; "----------------" &lt;&lt; std::endl;</span>
      <span class="c1">//   std::cout &lt;&lt; "y med: " &lt;&lt; node-&gt;y_med &lt;&lt; std::endl;</span>
      <span class="c1">//   std::cout &lt;&lt; "lower_bound idx: " &lt;&lt; bound_x_sorted_idx &lt;&lt;</span>
      <span class="c1">//   std::endl; std::cout &lt;&lt; "x_sorted_idx : \n\t"; for (const auto&amp; idx :</span>
      <span class="c1">//   node-&gt;x_sorted_idx) {</span>
      <span class="c1">//     std::cout &lt;&lt; idx &lt;&lt; " ";</span>
      <span class="c1">//   }</span>
      <span class="c1">//   std::cout &lt;&lt; std::endl;</span>

      <span class="c1">//   std::cout &lt;&lt; "left_cascading_map : \n\t";</span>
      <span class="c1">//   for (const auto&amp; cascading_idx : node-&gt;left_x_cascading_map) {</span>
      <span class="c1">//     std::cout &lt;&lt; cascading_idx &lt;&lt; " ";</span>
      <span class="c1">//   }</span>
      <span class="c1">//   std::cout &lt;&lt; std::endl;</span>

      <span class="c1">//   std::cout &lt;&lt; "left-&gt;x_sorted_idx : \n\t";</span>
      <span class="c1">//   for (const auto&amp; idx : node-&gt;left-&gt;x_sorted_idx) {</span>
      <span class="c1">//     std::cout &lt;&lt; idx &lt;&lt; " ";</span>
      <span class="c1">//   }</span>
      <span class="c1">//   std::cout &lt;&lt; std::endl;</span>

      <span class="c1">//   std::cout &lt;&lt; "right_cascading_map : \n\t";</span>
      <span class="c1">//   for (const auto&amp; cascading_idx : node-&gt;right_x_cascading_map) {</span>
      <span class="c1">//     std::cout &lt;&lt; cascading_idx &lt;&lt; " ";</span>
      <span class="c1">//   }</span>
      <span class="c1">//   std::cout &lt;&lt; std::endl;</span>

      <span class="c1">//   std::cout &lt;&lt; "right-&gt;x_sorted_idx : \n\t";</span>
      <span class="c1">//   for (const auto&amp; idx : node-&gt;right-&gt;x_sorted_idx) {</span>
      <span class="c1">//     std::cout &lt;&lt; idx &lt;&lt; " ";</span>
      <span class="c1">//   }</span>
      <span class="c1">//   std::cout &lt;&lt; std::endl;</span>
      <span class="c1">//   std::cout &lt;&lt; "left 1, right 0 : " &lt;&lt; (qy &lt;= node-&gt;y_med) &lt;&lt;</span>
      <span class="c1">//   std::endl; std::cout &lt;&lt; "closest_right_idx : " &lt;&lt; closest_right_idx</span>
      <span class="c1">//   &lt;&lt; std::endl;</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">bound_x_sorted_idx</span> <span class="o">&gt;=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">x_sorted_idx</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// NOTE</span>
      <span class="c1">// qy 랑 같은 y 에 멈출지 말지? (output sensitive 관련)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">qy</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">y_med</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">found_higher_x_sorted_idx</span> <span class="o">=</span>
            <span class="n">node</span><span class="o">-&gt;</span><span class="n">right_x_cascading_map</span><span class="p">[</span><span class="n">bound_x_sorted_idx</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">found_higher_x_sorted_idx</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span><span class="o">-&gt;</span><span class="n">x_sorted_idx</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
          <span class="kt">int</span> <span class="n">found_higher_idx</span> <span class="o">=</span>
              <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span><span class="o">-&gt;</span><span class="n">x_sorted_idx</span><span class="p">[</span><span class="n">found_higher_x_sorted_idx</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">closest_right_idx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">closest_right_idx</span> <span class="o">=</span> <span class="n">found_higher_idx</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">found_higher_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">pts</span><span class="p">[</span><span class="n">closest_right_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">closest_right_idx</span> <span class="o">=</span> <span class="n">found_higher_idx</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">// NOTE else?</span>

        <span class="n">bound_x_sorted_idx</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">left_x_cascading_map</span><span class="p">[</span><span class="n">bound_x_sorted_idx</span><span class="p">];</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">;</span>

      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">bound_x_sorted_idx</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right_x_cascading_map</span><span class="p">[</span><span class="n">bound_x_sorted_idx</span><span class="p">];</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// NOTE</span>
    <span class="c1">// if(closest_right_idx == -1){</span>
    <span class="c1">// }</span>
    <span class="k">return</span> <span class="n">closest_right_idx</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">int</span> <span class="n">QueryLeft</span><span class="p">(</span><span class="kt">int</span> <span class="n">qx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qy</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">node</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">bound_x_sorted_idx</span> <span class="o">=</span> <span class="n">UpperBound</span><span class="p">(</span><span class="n">x_sorted_idx</span><span class="p">,</span> <span class="n">qx</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">closest_left_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">!=</span> <span class="nb">nullptr</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">!=</span> <span class="nb">nullptr</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// std::cout &lt;&lt; "----------------" &lt;&lt; std::endl;</span>
      <span class="c1">// std::cout &lt;&lt; "y med: " &lt;&lt; node-&gt;y_med &lt;&lt; std::endl;</span>
      <span class="c1">// std::cout &lt;&lt; "lower_bound idx: " &lt;&lt; bound_x_sorted_idx &lt;&lt; std::endl;</span>
      <span class="c1">// std::cout &lt;&lt; "x_sorted_idx : \n\t";</span>
      <span class="c1">// for (const auto&amp; idx : node-&gt;x_sorted_idx) {</span>
      <span class="c1">//   std::cout &lt;&lt; idx &lt;&lt; " ";</span>
      <span class="c1">// }</span>
      <span class="c1">// std::cout &lt;&lt; std::endl;</span>

      <span class="c1">// std::cout &lt;&lt; "left_cascading_map_inverse : \n\t";</span>
      <span class="c1">// for (const auto&amp; cascading_idx : node-&gt;left_x_cascading_map_inverse) {</span>
      <span class="c1">//   std::cout &lt;&lt; cascading_idx &lt;&lt; " ";</span>
      <span class="c1">// }</span>
      <span class="c1">// std::cout &lt;&lt; std::endl;</span>

      <span class="c1">// std::cout &lt;&lt; "left-&gt;x_sorted_idx : \n\t";</span>
      <span class="c1">// for (const auto&amp; idx : node-&gt;left-&gt;x_sorted_idx) {</span>
      <span class="c1">//   std::cout &lt;&lt; idx &lt;&lt; " ";</span>
      <span class="c1">// }</span>
      <span class="c1">// std::cout &lt;&lt; std::endl;</span>

      <span class="c1">// std::cout &lt;&lt; "right_cascading_map_inverse : \n\t";</span>
      <span class="c1">// for (const auto&amp; cascading_idx : node-&gt;right_x_cascading_map_inverse) {</span>
      <span class="c1">//   std::cout &lt;&lt; cascading_idx &lt;&lt; " ";</span>
      <span class="c1">// }</span>
      <span class="c1">// std::cout &lt;&lt; std::endl;</span>

      <span class="c1">// std::cout &lt;&lt; "right-&gt;x_sorted_idx : \n\t";</span>
      <span class="c1">// for (const auto&amp; idx : node-&gt;right-&gt;x_sorted_idx) {</span>
      <span class="c1">//   std::cout &lt;&lt; idx &lt;&lt; " ";</span>
      <span class="c1">// }</span>
      <span class="c1">// std::cout &lt;&lt; std::endl;</span>
      <span class="c1">// std::cout &lt;&lt; "left 1, right 0 : " &lt;&lt; (qy &lt;= node-&gt;y_med) &lt;&lt; std::endl;</span>
      <span class="c1">// std::cout &lt;&lt; "closest_left_idx : " &lt;&lt; closest_left_idx &lt;&lt; std::endl;</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">bound_x_sorted_idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// NOTE</span>
      <span class="c1">// qy 랑 같은 y 에 멈출지 말지? (output sensitive 관련)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">qy</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">y_med</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">found_higher_x_sorted_idx</span> <span class="o">=</span>
            <span class="n">node</span><span class="o">-&gt;</span><span class="n">right_x_cascading_map_inverse</span><span class="p">[</span><span class="n">bound_x_sorted_idx</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">found_higher_x_sorted_idx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="kt">int</span> <span class="n">found_higher_idx</span> <span class="o">=</span>
              <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span><span class="o">-&gt;</span><span class="n">x_sorted_idx</span><span class="p">[</span><span class="n">found_higher_x_sorted_idx</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">closest_left_idx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">closest_left_idx</span> <span class="o">=</span> <span class="n">found_higher_idx</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">found_higher_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">pts</span><span class="p">[</span><span class="n">closest_left_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">closest_left_idx</span> <span class="o">=</span> <span class="n">found_higher_idx</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">// NOTE else?</span>

        <span class="n">bound_x_sorted_idx</span> <span class="o">=</span>
            <span class="n">node</span><span class="o">-&gt;</span><span class="n">left_x_cascading_map_inverse</span><span class="p">[</span><span class="n">bound_x_sorted_idx</span><span class="p">];</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">;</span>

      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">bound_x_sorted_idx</span> <span class="o">=</span>
            <span class="n">node</span><span class="o">-&gt;</span><span class="n">right_x_cascading_map_inverse</span><span class="p">[</span><span class="n">bound_x_sorted_idx</span><span class="p">];</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// NOTE</span>
    <span class="c1">// last node consideration?</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">==</span> <span class="nb">nullptr</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">x_sorted_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">qx</span> <span class="o">&amp;&amp;</span>
          <span class="n">pts</span><span class="p">[</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">x_sorted_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">qy</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="err">\</span><span class="p">(</span><span class="n">closest</span><span class="err">\</span><span class="n">_left</span><span class="err">\</span><span class="n">_idx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="err">\</span><span class="o">||</span>
            <span class="n">pts</span><span class="p">[</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">x_sorted_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">pts</span><span class="p">[</span><span class="n">closest_left_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
          <span class="n">closest_left_idx</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">x_sorted_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">closest_left_idx</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// x_sorted_idx -&gt; evaluation -&gt; upperbound -&gt; idx</span>
  <span class="kt">int</span> <span class="n">UpperBound</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">x_sorted_idx_</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qx</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// not containing end r</span>
    <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">x_sorted_idx_</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">med_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">med</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">x_sorted_idx_</span><span class="p">[</span><span class="n">med_idx</span><span class="p">]][</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">med</span> <span class="o">&lt;=</span> <span class="n">qx</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">med_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">med_idx</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">l</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// x_sorted_idx -&gt; evaluation -&gt; lowerbound -&gt; idx</span>
  <span class="kt">int</span> <span class="n">LowerBound</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">x_sorted_idx_</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qx</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// not containing end r</span>
    <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">x_sorted_idx_</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">med_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">med</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">x_sorted_idx_</span><span class="p">[</span><span class="n">med_idx</span><span class="p">]][</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">med</span> <span class="o">&lt;</span> <span class="n">qx</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">med_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">med_idx</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">l</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Solution</span> <span class="p">{</span>
 <span class="nl">public:</span>
  <span class="c1">// using output-sensitive solution</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">getSkyline</span><span class="p">(</span>
      <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&amp;</span> <span class="n">buildings</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">begin</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">end</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">new_buildings</span><span class="p">;</span>
    <span class="n">begin</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">new_buildings</span> <span class="o">=</span> <span class="n">PreprocessBuildings</span><span class="p">(</span><span class="n">buildings</span><span class="p">);</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"# preprocess : "</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span>
                                                                       <span class="n">begin</span><span class="p">)</span>
                     <span class="p">.</span><span class="n">count</span><span class="p">()</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">new_buildings</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>

    <span class="c1">// starting at 4 too slow</span>
    <span class="kt">int</span> <span class="n">h_cnt</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">h_star</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="c1">// 2, 4, 16, 256 , ...</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">ans</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">h_star</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">h_cnt</span><span class="o">++</span><span class="p">));</span>
      <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">skyline</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="n">h_star</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">h_star</span> <span class="o">*</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">k</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">//</span>
      <span class="c1">// std::cout &lt;&lt; "----- Skyline ----- [ h*: " &lt;&lt; h_star &lt;&lt; ", k: " &lt;&lt; k</span>
      <span class="c1">//           &lt;&lt; " ]" &lt;&lt; std::endl;</span>
      <span class="n">begin</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

      <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&gt;</span> <span class="n">subgp_buildings</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">subgp_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">h_star</span><span class="p">;</span>
        <span class="n">subgp_buildings</span><span class="p">[</span><span class="n">subgp_idx</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">new_buildings</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&gt;</span> <span class="n">subgp_skylines</span><span class="p">;</span>
      <span class="n">subgp_skylines</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">b</span> <span class="o">=</span>
            <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
        <span class="n">subgp_skylines</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">GetSkylineSlow</span><span class="p">(</span><span class="n">subgp_buildings</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
        <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">e</span> <span class="o">=</span>
            <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
        <span class="c1">// std::cout &lt;&lt; "# subgp each skyline : " &lt;&lt;</span>
        <span class="c1">// std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(e - b).count()</span>
        <span class="c1">// &lt;&lt; std::endl; std::cout &lt;&lt; "skyline for subgp " &lt;&lt; i &lt;&lt; std::endl;</span>
        <span class="c1">// for (const auto&amp; pt : subgp_skylines[i]) {</span>
        <span class="c1">//   std::cout &lt;&lt; "(" &lt;&lt; pt[0] &lt;&lt; ", " &lt;&lt; pt[1] &lt;&lt; ") - ";</span>
        <span class="c1">// }</span>
        <span class="c1">// std::cout &lt;&lt; std::endl;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">subgp_skylines</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"# subgp skyline ["</span> <span class="o">&lt;&lt;</span> <span class="n">h_star</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">k</span> <span class="o">&lt;&lt;</span> <span class="s">"]: "</span>
                <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span>
                                                                         <span class="n">begin</span><span class="p">)</span>
                       <span class="p">.</span><span class="n">count</span><span class="p">()</span>
                <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

      <span class="n">begin</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
      <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Tree</span><span class="o">&gt;</span> <span class="n">subgp_trees</span><span class="p">;</span>
      <span class="n">subgp_trees</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
      <span class="kt">int</span> <span class="n">sum_td1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sum_td2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sum_td3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sum_td4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sum_td5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
          <span class="n">sum_td6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">subgp_trees</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">subgp_skylines</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">sum_td1</span> <span class="o">+=</span> <span class="n">subgp_trees</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">td1</span><span class="p">;</span>
        <span class="n">sum_td2</span> <span class="o">+=</span> <span class="n">subgp_trees</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">td2</span><span class="p">;</span>
        <span class="n">sum_td3</span> <span class="o">+=</span> <span class="n">subgp_trees</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">td3</span><span class="p">;</span>
        <span class="n">sum_td4</span> <span class="o">+=</span> <span class="n">subgp_trees</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">td4</span><span class="p">;</span>
        <span class="n">sum_td5</span> <span class="o">+=</span> <span class="n">subgp_trees</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">td5</span><span class="p">;</span>
        <span class="n">sum_td6</span> <span class="o">+=</span> <span class="n">subgp_trees</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">td6</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"# tree construction : "</span>
                <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span>
                                                                         <span class="n">begin</span><span class="p">)</span>
                       <span class="p">.</span><span class="n">count</span><span class="p">()</span>
                <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="c1">// std::cout &lt;&lt; "# tree construction td1: " &lt;&lt; sum_td1 &lt;&lt; std::endl;</span>
      <span class="c1">// std::cout &lt;&lt; "# tree construction td2: " &lt;&lt; sum_td2 &lt;&lt; std::endl;</span>
      <span class="c1">// std::cout &lt;&lt; "# tree construction td3: " &lt;&lt; sum_td3 &lt;&lt; std::endl;</span>
      <span class="c1">// std::cout &lt;&lt; "# tree construction td4: " &lt;&lt; sum_td4 &lt;&lt; std::endl;</span>
      <span class="c1">// std::cout &lt;&lt; "# tree construction td5: " &lt;&lt; sum_td5 &lt;&lt; std::endl;</span>
      <span class="c1">// std::cout &lt;&lt; "# tree construction td6: " &lt;&lt; sum_td6 &lt;&lt; std::endl;</span>

      <span class="c1">// merge</span>
      <span class="kt">int</span> <span class="n">cur_x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">cur_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">cur_subgp_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">cur_subgp_pt_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="kt">bool</span> <span class="n">succeeded</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="c1">// from start point, h_start + 1 iteration needed</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">h_star</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">begin</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
        <span class="c1">// std::cout &lt;&lt; "- h* loop : " &lt;&lt; i &lt;&lt; " / " &lt;&lt; h_star &lt;&lt; std::endl;</span>
        <span class="c1">// std::cout &lt;&lt; "cur_x: " &lt;&lt; cur_x &lt;&lt; std::endl</span>
        <span class="c1">//           &lt;&lt; "cur_y: " &lt;&lt; cur_y &lt;&lt; std::endl</span>
        <span class="c1">//           &lt;&lt; "cur_subgp_idx: " &lt;&lt; cur_subgp_idx &lt;&lt; std::endl</span>
        <span class="c1">//           &lt;&lt; "cur_subgp_pt_idx: " &lt;&lt; cur_subgp_pt_idx &lt;&lt; std::endl;</span>
        <span class="kt">int</span> <span class="n">next_x</span><span class="p">,</span> <span class="n">next_y</span><span class="p">,</span> <span class="n">next_subgp_idx</span><span class="p">,</span> <span class="n">next_subgp_pt_idx</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">next_x</span><span class="p">,</span> <span class="n">next_y</span><span class="p">,</span> <span class="n">next_subgp_idx</span><span class="p">,</span> <span class="n">next_subgp_pt_idx</span><span class="p">)</span> <span class="o">=</span>
            <span class="n">FindNextSkylinePt</span><span class="p">(</span><span class="n">subgp_trees</span><span class="p">,</span> <span class="n">cur_x</span><span class="p">,</span> <span class="n">cur_y</span><span class="p">);</span>
        <span class="c1">// std::cout &lt;&lt; "next_x: " &lt;&lt; next_x &lt;&lt; std::endl</span>
        <span class="c1">//           &lt;&lt; "next_y: " &lt;&lt; next_y &lt;&lt; std::endl</span>
        <span class="c1">//           &lt;&lt; "next_subgp_idx: " &lt;&lt; next_subgp_idx &lt;&lt; std::endl</span>
        <span class="c1">//           &lt;&lt; "next_subgp_pt_idx: " &lt;&lt; next_subgp_pt_idx &lt;&lt; std::endl;</span>
        <span class="c1">// std::cout</span>
        <span class="c1">//     &lt;&lt; "Query next response: "</span>
        <span class="c1">//     &lt;&lt; \(cur\_subgp\_idx == -1 \||</span>
        <span class="c1">//         cur_subgp_pt_idx &lt; subgp_trees[cur_subgp_idx].pts.size() - 1)</span>
        <span class="c1">//     &lt;&lt; \(next\_x == -1 \||</span>
        <span class="c1">//         (cur_subgp_idx != -1 &amp;&amp;</span>
        <span class="c1">//          next_x &gt;</span>
        <span class="c1">//              subgp_trees[cur_subgp_idx].pts[cur_subgp_pt_idx +</span>
        <span class="c1">//              1][0]))</span>
        <span class="c1">//     &lt;&lt; std::endl;</span>
        <span class="k">if</span> <span class="err">\</span><span class="p">(</span><span class="n">cur</span><span class="err">\</span><span class="n">_subgp</span><span class="err">\</span><span class="n">_idx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="err">\</span><span class="o">||</span>
            <span class="n">cur_subgp_pt_idx</span> <span class="o">&lt;</span> <span class="n">subgp_trees</span><span class="p">[</span><span class="n">cur_subgp_idx</span><span class="p">].</span><span class="n">pts</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// next subgp pt exists</span>

          <span class="k">if</span> <span class="err">\</span><span class="p">(</span><span class="n">next</span><span class="err">\</span><span class="n">_x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="err">\</span><span class="o">||</span>
              <span class="p">(</span><span class="n">cur_subgp_idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span>
               <span class="n">next_x</span> <span class="o">&gt;</span>
                   <span class="n">subgp_trees</span><span class="p">[</span><span class="n">cur_subgp_idx</span><span class="p">].</span><span class="n">pts</span><span class="p">[</span><span class="n">cur_subgp_pt_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
            <span class="c1">// no query response</span>
            <span class="c1">// if cur_subgp_idx == -1 (init), it must jump</span>
            <span class="c1">// to be drop case, next_x must be farther than the cur next x</span>
            <span class="c1">// drop to cur_subgp_idx+1 and need to find y</span>
            <span class="c1">// assert idx not -1 if no query resp</span>
            <span class="kt">int</span> <span class="n">cur_next_x</span> <span class="o">=</span>
                <span class="n">subgp_trees</span><span class="p">[</span><span class="n">cur_subgp_idx</span><span class="p">].</span><span class="n">pts</span><span class="p">[</span><span class="n">cur_subgp_pt_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
            <span class="kt">int</span> <span class="n">cur_next_y</span> <span class="o">=</span>
                <span class="n">subgp_trees</span><span class="p">[</span><span class="n">cur_subgp_idx</span><span class="p">].</span><span class="n">pts</span><span class="p">[</span><span class="n">cur_subgp_pt_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
            <span class="kt">int</span> <span class="n">prev_x</span><span class="p">,</span> <span class="n">prev_y</span><span class="p">,</span> <span class="n">prev_subgp_idx</span><span class="p">,</span> <span class="n">prev_subgp_pt_idx</span><span class="p">;</span>
            <span class="c1">// std::cout &lt;&lt; "Query prev: (" &lt;&lt; cur_next_x &lt;&lt; ", " &lt;&lt; cur_next_y</span>
            <span class="c1">//           &lt;&lt; ")" &lt;&lt; std::endl;</span>
            <span class="c1">// NOTE: query y?</span>
            <span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">prev_x</span><span class="p">,</span> <span class="n">prev_y</span><span class="p">,</span> <span class="n">prev_subgp_idx</span><span class="p">,</span> <span class="n">prev_subgp_pt_idx</span><span class="p">)</span> <span class="o">=</span>
                <span class="n">FindPrevSkylinePt</span><span class="p">(</span><span class="n">subgp_trees</span><span class="p">,</span> <span class="n">cur_next_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cur_subgp_idx</span><span class="p">);</span>
            <span class="c1">// std::cout &lt;&lt; "prev_x: " &lt;&lt; prev_x &lt;&lt; std::endl</span>
            <span class="c1">//           &lt;&lt; "prev_y: " &lt;&lt; prev_y &lt;&lt; std::endl</span>
            <span class="c1">//           &lt;&lt; "prev_subgp_idx: " &lt;&lt; prev_subgp_idx &lt;&lt; std::endl</span>
            <span class="c1">//           &lt;&lt; "prev_subgp_pt_idx: " &lt;&lt; prev_subgp_pt_idx</span>
            <span class="c1">//           &lt;&lt; std::endl;</span>
            <span class="c1">// drop to prev y only if it is higher than drop height in the same</span>
            <span class="c1">// subgp</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">prev_y</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">prev_y</span> <span class="o">&gt;</span> <span class="n">cur_next_y</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">cur_x</span> <span class="o">=</span> <span class="n">cur_next_x</span><span class="p">;</span>
              <span class="n">cur_y</span> <span class="o">=</span> <span class="n">prev_y</span><span class="p">;</span>
              <span class="n">cur_subgp_idx</span> <span class="o">=</span> <span class="n">prev_subgp_idx</span><span class="p">;</span>
              <span class="n">cur_subgp_pt_idx</span> <span class="o">=</span> <span class="n">prev_subgp_pt_idx</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="c1">// drop to current subgp next pt</span>
              <span class="n">cur_x</span> <span class="o">=</span> <span class="n">cur_next_x</span><span class="p">;</span>
              <span class="n">cur_y</span> <span class="o">=</span> <span class="n">cur_next_y</span><span class="p">;</span>
              <span class="n">cur_subgp_pt_idx</span> <span class="o">=</span> <span class="n">cur_subgp_pt_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// jump (move to the query response)</span>
            <span class="c1">// including cur subgp.</span>
            <span class="n">cur_x</span> <span class="o">=</span> <span class="n">next_x</span><span class="p">;</span>
            <span class="n">cur_y</span> <span class="o">=</span> <span class="n">next_y</span><span class="p">;</span>
            <span class="n">cur_subgp_idx</span> <span class="o">=</span> <span class="n">next_subgp_idx</span><span class="p">;</span>
            <span class="n">cur_subgp_pt_idx</span> <span class="o">=</span> <span class="n">next_subgp_pt_idx</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="c1">// else pt is the last (0,0) of the subgp</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">next_x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// no query response</span>
            <span class="n">succeeded</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// jump (move to the query response)</span>
            <span class="n">cur_x</span> <span class="o">=</span> <span class="n">next_x</span><span class="p">;</span>
            <span class="n">cur_y</span> <span class="o">=</span> <span class="n">next_y</span><span class="p">;</span>
            <span class="n">cur_subgp_idx</span> <span class="o">=</span> <span class="n">next_subgp_idx</span><span class="p">;</span>
            <span class="n">cur_subgp_pt_idx</span> <span class="o">=</span> <span class="n">next_subgp_pt_idx</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">// std::cout &lt;&lt; "-- skyline push : (" &lt;&lt; cur_x &lt;&lt; ", " &lt;&lt; cur_y &lt;&lt; ")"</span>
        <span class="c1">//           &lt;&lt; std::endl;</span>
        <span class="n">skyline</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">cur_x</span><span class="p">,</span> <span class="n">cur_y</span><span class="p">});</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

        <span class="c1">// std::cout &lt;&lt; "# h* loop queary : " &lt;&lt;</span>
        <span class="c1">// std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end -</span>
        <span class="c1">// begin).count() &lt;&lt; std::endl;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">succeeded</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">skyline</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="p">;</span>  <span class="c1">// std::cout &lt;&lt; " - fail" &lt;&lt; std::endl;</span>
      <span class="p">}</span>

      <span class="c1">// h_star = h_star * h_star;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">FindNextSkylinePt</span><span class="p">(</span>
      <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Tree</span><span class="o">&gt;&amp;</span> <span class="n">subgp_trees</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qy</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">next_x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">next_y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">next_subgp_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">next_subgp_pt_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">subgp_trees</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">subgp_tree</span> <span class="o">=</span> <span class="n">subgp_trees</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
      <span class="kt">int</span> <span class="n">resp_idx</span> <span class="o">=</span> <span class="n">subgp_tree</span><span class="p">.</span><span class="n">QueryRight</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">resp_idx</span> <span class="o">&gt;</span> <span class="n">subgp_tree</span><span class="p">.</span><span class="n">pts</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="kt">int</span> <span class="n">next_cand_x</span> <span class="o">=</span> <span class="n">subgp_tree</span><span class="p">.</span><span class="n">pts</span><span class="p">[</span><span class="n">resp_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
      <span class="kt">int</span> <span class="n">next_cand_y</span> <span class="o">=</span> <span class="n">subgp_tree</span><span class="p">.</span><span class="n">pts</span><span class="p">[</span><span class="n">resp_idx</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
      <span class="k">if</span> <span class="err">\</span><span class="p">(</span><span class="n">next</span><span class="err">\</span><span class="n">_x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="err">\</span><span class="o">||</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="err">\</span><span class="p">(</span><span class="n">next</span><span class="err">\</span><span class="n">_x</span><span class="p">,</span> <span class="o">-</span><span class="n">next</span><span class="err">\</span><span class="n">_y</span><span class="p">)</span> <span class="o">&gt;</span>
                              <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">next_cand_x</span><span class="p">,</span> <span class="o">-</span><span class="n">next_cand_y</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">next_x</span> <span class="o">=</span> <span class="n">next_cand_x</span><span class="p">;</span>
        <span class="n">next_y</span> <span class="o">=</span> <span class="n">next_cand_y</span><span class="p">;</span>
        <span class="n">next_subgp_idx</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
        <span class="n">next_subgp_pt_idx</span> <span class="o">=</span> <span class="n">resp_idx</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">next_x</span><span class="p">,</span> <span class="n">next_y</span><span class="p">,</span> <span class="n">next_subgp_idx</span><span class="p">,</span> <span class="n">next_subgp_pt_idx</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// regardless x , find highest y value dominating query pt</span>
  <span class="c1">// return highest except cur subgp</span>
  <span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">FindPrevSkylinePt</span><span class="p">(</span>
      <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Tree</span><span class="o">&gt;&amp;</span> <span class="n">subgp_trees</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qy</span><span class="p">,</span>
      <span class="kt">int</span> <span class="n">cur_subgp_idx</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">prev_x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">prev_y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">prev_subgp_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">prev_subgp_pt_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">subgp_trees</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">cur_subgp_idx</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">subgp_tree</span> <span class="o">=</span> <span class="n">subgp_trees</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
      <span class="kt">int</span> <span class="n">resp_idx</span> <span class="o">=</span> <span class="n">subgp_tree</span><span class="p">.</span><span class="n">QueryLeft</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">resp_idx</span> <span class="o">&gt;</span> <span class="n">subgp_tree</span><span class="p">.</span><span class="n">pts</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="kt">int</span> <span class="n">prev_cand_x</span> <span class="o">=</span> <span class="n">subgp_tree</span><span class="p">.</span><span class="n">pts</span><span class="p">[</span><span class="n">resp_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
      <span class="kt">int</span> <span class="n">prev_cand_y</span> <span class="o">=</span> <span class="n">subgp_tree</span><span class="p">.</span><span class="n">pts</span><span class="p">[</span><span class="n">resp_idx</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
      <span class="k">if</span> <span class="err">\</span><span class="p">(</span><span class="n">prev</span><span class="err">\</span><span class="n">_x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="err">\</span><span class="o">||</span> <span class="n">prev</span><span class="err">\</span><span class="n">_y</span> <span class="o">&lt;</span> <span class="n">prev</span><span class="err">\</span><span class="n">_cand</span><span class="err">\</span><span class="n">_y</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">prev_x</span> <span class="o">=</span> <span class="n">prev_cand_x</span><span class="p">;</span>
        <span class="n">prev_y</span> <span class="o">=</span> <span class="n">prev_cand_y</span><span class="p">;</span>
        <span class="n">prev_subgp_idx</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
        <span class="n">prev_subgp_pt_idx</span> <span class="o">=</span> <span class="n">resp_idx</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">prev_x</span><span class="p">,</span> <span class="n">prev_y</span><span class="p">,</span> <span class="n">prev_subgp_idx</span><span class="p">,</span> <span class="n">prev_subgp_pt_idx</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// find skyline given building segments in O(n log n)</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">GetSkylineSlow</span><span class="p">(</span>
      <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&amp;</span> <span class="n">buildings</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">skyline</span><span class="p">;</span>
    <span class="n">skyline</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">buildings</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">segs</span><span class="p">;</span>
    <span class="n">segs</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">buildings</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">buildings</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">buildings</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">segs</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">});</span>
      <span class="n">segs</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">(</span><span class="n">segs</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">segs</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

    <span class="n">std</span><span class="o">::</span><span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">pq</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">seg_idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">seg_idx</span> <span class="o">&lt;</span> <span class="n">segs</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">cur_x</span><span class="p">;</span>
      <span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">cur_x</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ignore</span><span class="p">)</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">];</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">seg_idx</span> <span class="o">&lt;</span> <span class="n">segs</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">cur_x</span> <span class="o">==</span> <span class="n">segs</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">].</span><span class="n">first</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">building_idx</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ignore</span><span class="p">,</span> <span class="n">building_idx</span><span class="p">)</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">];</span>
        <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">buildings</span><span class="p">[</span><span class="n">building_idx</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">cur_x</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">pq</span><span class="p">.</span><span class="n">push</span><span class="p">({</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]});</span>
          <span class="c1">// pq.emplace(b[2], b[1]);</span>
        <span class="p">}</span>
        <span class="n">seg_idx</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// remove immediately as it ends</span>
      <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">pq</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">pq</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">second</span> <span class="o">&lt;=</span> <span class="n">cur_x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pq</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="kt">int</span> <span class="n">cur_height</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pq</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">cur_height</span> <span class="o">=</span> <span class="n">pq</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">first</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="err">\</span><span class="p">(</span><span class="n">skyline</span><span class="p">.</span><span class="n">empty</span><span class="err">\</span><span class="p">()</span> <span class="err">\</span><span class="o">||</span> <span class="n">skyline</span><span class="p">.</span><span class="n">back</span><span class="err">\</span><span class="p">()</span><span class="err">\</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cur</span><span class="err">\</span><span class="n">_height</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">skyline</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">cur_x</span><span class="p">,</span> <span class="n">cur_height</span><span class="p">});</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">skyline</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// remove same height connected buildings</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">PreprocessBuildings</span><span class="p">(</span>
      <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&amp;</span> <span class="n">buildings</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">um</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">new_buildings</span><span class="p">;</span>
    <span class="n">new_buildings</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">buildings</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
    <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">b</span> <span class="o">:</span> <span class="n">buildings</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">um</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="n">um</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">new_buildings</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
        <span class="n">um</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">idx</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// assert um[b[2]] not empty</span>
        <span class="k">auto</span><span class="o">&amp;</span> <span class="n">last_b</span> <span class="o">=</span> <span class="n">new_buildings</span><span class="p">[</span><span class="n">um</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]]];</span>
        <span class="c1">// intersects</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">last_b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">last_b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">last_b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="p">}</span>
          <span class="c1">// contained</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="c1">// separated</span>
          <span class="n">new_buildings</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
          <span class="n">um</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">idx</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">new_buildings</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">TestTree</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"===== TestTree ====="</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">pts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">},</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span> <span class="p">{</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="mi">19</span><span class="p">,</span> <span class="mi">8</span><span class="p">}};</span>
    <span class="n">Tree</span> <span class="n">t</span><span class="p">(</span><span class="n">pts</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="n">TestQuery</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"===== TestQuery ====="</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">pts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">},</span> <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span> <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>   <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>  <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">}};</span>
    <span class="n">Tree</span> <span class="n">t</span><span class="p">(</span><span class="n">pts</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">test_list</span> <span class="o">=</span> <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">LowerBound</span><span class="p">(</span><span class="n">test_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"test lowerbound for 5 : "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">LowerBound</span><span class="p">(</span><span class="n">test_list</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"test lowerbound for 6 : "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">LowerBound</span><span class="p">(</span><span class="n">test_list</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"test lowerbound for 7 : "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">LowerBound</span><span class="p">(</span><span class="n">test_list</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"test lowerbound for 0 : "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">LowerBound</span><span class="p">(</span><span class="n">test_list</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"test lowerbound for 11 : "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">i</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">UpperBound</span><span class="p">(</span><span class="n">test_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"test upperbound for 5 : "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">UpperBound</span><span class="p">(</span><span class="n">test_list</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"test upperbound for 6 : "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">UpperBound</span><span class="p">(</span><span class="n">test_list</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"test upperbound for 7 : "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">UpperBound</span><span class="p">(</span><span class="n">test_list</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"test upperbound for 0 : "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">UpperBound</span><span class="p">(</span><span class="n">test_list</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"test upperbound for 11 : "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="n">TestQuery2</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"===== TestQuery2 ====="</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">pts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">14</span><span class="p">},</span>  <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">26</span><span class="p">},</span> <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>   <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>   <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span> <span class="p">{</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">14</span><span class="p">,</span> <span class="mi">20</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="mi">18</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">20</span><span class="p">,</span> <span class="mi">18</span><span class="p">},</span> <span class="p">{</span><span class="mi">22</span><span class="p">,</span> <span class="mi">24</span><span class="p">},</span> <span class="p">{</span><span class="mi">24</span><span class="p">,</span> <span class="mi">16</span><span class="p">},</span> <span class="p">{</span><span class="mi">26</span><span class="p">,</span> <span class="mi">22</span><span class="p">},</span> <span class="p">{</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">}};</span>

    <span class="n">Tree</span> <span class="n">t</span><span class="p">(</span><span class="n">pts</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"pts : "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="o">:</span> <span class="n">pts</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">") - "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"y_order : "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">idx</span> <span class="o">:</span> <span class="n">t</span><span class="p">.</span><span class="n">x_sorted_idx</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">t</span><span class="p">.</span><span class="n">idx_to_y_order</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">qs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">},</span>  <span class="p">{</span><span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">},</span> <span class="p">{</span><span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">9</span><span class="p">,</span> <span class="mi">27</span><span class="p">},</span> <span class="p">{</span><span class="mi">9</span><span class="p">,</span> <span class="mi">28</span><span class="p">},</span> <span class="p">{</span><span class="mi">29</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">},</span> <span class="p">{</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">19</span><span class="p">,</span> <span class="mi">18</span><span class="p">}};</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">qs</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Query : ("</span> <span class="o">&lt;&lt;</span> <span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="o">&lt;&lt;</span> <span class="s">") : "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">qidx</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">QueryRight</span><span class="p">(</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">qidx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">qidx</span> <span class="o">&lt;&lt;</span> <span class="s">" =&gt; "</span>
                  <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">pts</span><span class="p">[</span><span class="n">qidx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">pts</span><span class="p">[</span><span class="n">qidx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">")"</span>
                  <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">qidx</span> <span class="o">&lt;&lt;</span> <span class="s">" =&gt; not found"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">TestQuery3</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"===== TestQuery3 ====="</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">pts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">14</span><span class="p">},</span>  <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">26</span><span class="p">},</span>  <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>   <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span> <span class="p">{</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">14</span><span class="p">,</span> <span class="mi">20</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">18</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span>  <span class="p">{</span><span class="mi">20</span><span class="p">,</span> <span class="mi">18</span><span class="p">},</span> <span class="p">{</span><span class="mi">22</span><span class="p">,</span> <span class="mi">24</span><span class="p">},</span> <span class="p">{</span><span class="mi">24</span><span class="p">,</span> <span class="mi">16</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">26</span><span class="p">,</span> <span class="mi">22</span><span class="p">},</span> <span class="p">{</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">},</span> <span class="p">{</span><span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">}};</span>

    <span class="n">Tree</span> <span class="n">t</span><span class="p">(</span><span class="n">pts</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"pts : "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="o">:</span> <span class="n">pts</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">") - "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"y_order : "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">idx</span> <span class="o">:</span> <span class="n">t</span><span class="p">.</span><span class="n">x_sorted_idx</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">t</span><span class="p">.</span><span class="n">idx_to_y_order</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">qs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">},</span>   <span class="p">{</span><span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">},</span> <span class="p">{</span><span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">},</span>  <span class="p">{</span><span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">9</span><span class="p">,</span> <span class="mi">27</span><span class="p">},</span>  <span class="p">{</span><span class="mi">9</span><span class="p">,</span> <span class="mi">28</span><span class="p">},</span> <span class="p">{</span><span class="mi">29</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>  <span class="p">{</span><span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">},</span>  <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">},</span> <span class="p">{</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>  <span class="p">{</span><span class="mi">19</span><span class="p">,</span> <span class="mi">18</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">},</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">14</span><span class="p">},</span> <span class="p">{</span><span class="mi">26</span><span class="p">,</span> <span class="mi">22</span><span class="p">},</span> <span class="p">{</span><span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">}};</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">qs</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Query : ("</span> <span class="o">&lt;&lt;</span> <span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="o">&lt;&lt;</span> <span class="s">") : "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">qidx</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">QueryLeft</span><span class="p">(</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">qidx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">qidx</span> <span class="o">&lt;&lt;</span> <span class="s">" =&gt; "</span>
                  <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">pts</span><span class="p">[</span><span class="n">qidx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">pts</span><span class="p">[</span><span class="n">qidx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">")"</span>
                  <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">qidx</span> <span class="o">&lt;&lt;</span> <span class="s">" =&gt; not found"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="n">TestSlow</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"===== TestSlow ====="</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">buildings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">},</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span> <span class="p">{</span><span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="mi">19</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">8</span><span class="p">}};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">ans</span><span class="p">;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">GetSkylineSlow</span><span class="p">(</span><span class="n">buildings</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="o">:</span> <span class="n">ans</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">") - "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">TestSlow2</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"===== TestSlow2 ====="</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">buildings</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">buildings</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">});</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">ans</span><span class="p">;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">GetSkylineSlow</span><span class="p">(</span><span class="n">buildings</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="o">:</span> <span class="n">ans</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">") - "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">TestSlow3</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"===== TestSlow3 ====="</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">buildings</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">buildings</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">});</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">ans</span><span class="p">;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">GetSkylineSlow</span><span class="p">(</span><span class="n">buildings</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="o">:</span> <span class="n">ans</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">") - "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="n">TestSkyline</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"===== TestSkyline ====="</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">buildings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">},</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span> <span class="p">{</span><span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="mi">19</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">8</span><span class="p">}};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">ans</span><span class="p">;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">getSkyline</span><span class="p">(</span><span class="n">buildings</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="o">:</span> <span class="n">ans</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">") - "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">TestSkyline2</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"===== TestSkyline2 ====="</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">buildings</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">buildings</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">});</span>
    <span class="p">}</span>
    <span class="n">buildings</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">101</span><span class="p">});</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">ans</span><span class="p">;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">getSkyline</span><span class="p">(</span><span class="n">buildings</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"----- Result -----"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="o">:</span> <span class="n">ans</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">") - "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">TestSkyline3</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"===== TestSkyline3 ====="</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">buildings</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">buildings</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">});</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">ans</span><span class="p">;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">getSkyline</span><span class="p">(</span><span class="n">buildings</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"----- Result -----"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="o">:</span> <span class="n">ans</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">") - "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">TestSkyline4</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"===== TestSkyline4 ====="</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">buildings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">}};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">ans</span><span class="p">;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">getSkyline</span><span class="p">(</span><span class="n">buildings</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"----- Result -----"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="o">:</span> <span class="n">ans</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">") - "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">TestSkyline5</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"===== TestSkyline5 ====="</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">buildings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">219</span><span class="p">},</span>  <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">228</span><span class="p">},</span>  <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">106</span><span class="p">},</span>  <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">65</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>    <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>    <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">14</span><span class="p">},</span>   <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">225</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">187</span><span class="p">},</span>  <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">118</span><span class="p">},</span>  <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">211</span><span class="p">},</span>  <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">97</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">92</span><span class="p">},</span>   <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">188</span><span class="p">},</span>  <span class="p">{</span><span class="mi">7</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">42</span><span class="p">},</span>   <span class="p">{</span><span class="mi">7</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">78</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">7</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">163</span><span class="p">},</span>  <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">212</span><span class="p">},</span>  <span class="p">{</span><span class="mi">9</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">125</span><span class="p">},</span>  <span class="p">{</span><span class="mi">9</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">200</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">9</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">74</span><span class="p">},</span>  <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">58</span><span class="p">},</span>  <span class="p">{</span><span class="mi">11</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">179</span><span class="p">},</span> <span class="p">{</span><span class="mi">12</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">215</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">12</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">161</span><span class="p">},</span> <span class="p">{</span><span class="mi">12</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">198</span><span class="p">},</span> <span class="p">{</span><span class="mi">13</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">48</span><span class="p">},</span>  <span class="p">{</span><span class="mi">13</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">222</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">14</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>   <span class="p">{</span><span class="mi">15</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">222</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">196</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">142</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">176</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">114</span><span class="p">},</span> <span class="p">{</span><span class="mi">18</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>   <span class="p">{</span><span class="mi">19</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">149</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">20</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">53</span><span class="p">},</span>  <span class="p">{</span><span class="mi">21</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">41</span><span class="p">},</span>  <span class="p">{</span><span class="mi">23</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">43</span><span class="p">},</span>  <span class="p">{</span><span class="mi">24</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">75</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">24</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">20</span><span class="p">},</span>  <span class="p">{</span><span class="mi">27</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span>   <span class="p">{</span><span class="mi">31</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">58</span><span class="p">},</span>  <span class="p">{</span><span class="mi">31</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">123</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">31</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">146</span><span class="p">},</span> <span class="p">{</span><span class="mi">33</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">27</span><span class="p">},</span>  <span class="p">{</span><span class="mi">35</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">190</span><span class="p">},</span> <span class="p">{</span><span class="mi">35</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">116</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">37</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">81</span><span class="p">},</span>  <span class="p">{</span><span class="mi">38</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">99</span><span class="p">},</span>  <span class="p">{</span><span class="mi">39</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">125</span><span class="p">},</span> <span class="p">{</span><span class="mi">39</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">144</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">40</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>   <span class="p">{</span><span class="mi">45</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">229</span><span class="p">},</span> <span class="p">{</span><span class="mi">47</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">10</span><span class="p">},</span>  <span class="p">{</span><span class="mi">47</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">152</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">48</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">69</span><span class="p">},</span>  <span class="p">{</span><span class="mi">48</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>   <span class="p">{</span><span class="mi">49</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">204</span><span class="p">},</span> <span class="p">{</span><span class="mi">49</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">117</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">50</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">174</span><span class="p">},</span> <span class="p">{</span><span class="mi">50</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">147</span><span class="p">},</span> <span class="p">{</span><span class="mi">52</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>   <span class="p">{</span><span class="mi">52</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">84</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">54</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">201</span><span class="p">},</span> <span class="p">{</span><span class="mi">57</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">47</span><span class="p">},</span>  <span class="p">{</span><span class="mi">58</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">215</span><span class="p">},</span> <span class="p">{</span><span class="mi">58</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">57</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">61</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">190</span><span class="p">},</span> <span class="p">{</span><span class="mi">66</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">34</span><span class="p">},</span>  <span class="p">{</span><span class="mi">66</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">53</span><span class="p">},</span>  <span class="p">{</span><span class="mi">67</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">9</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">68</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">175</span><span class="p">},</span> <span class="p">{</span><span class="mi">70</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">131</span><span class="p">},</span> <span class="p">{</span><span class="mi">74</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">155</span><span class="p">},</span> <span class="p">{</span><span class="mi">74</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">145</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">76</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">26</span><span class="p">},</span>  <span class="p">{</span><span class="mi">82</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">40</span><span class="p">},</span>  <span class="p">{</span><span class="mi">83</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">132</span><span class="p">},</span> <span class="p">{</span><span class="mi">88</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">99</span><span class="p">}};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">ans</span><span class="p">;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">getSkyline</span><span class="p">(</span><span class="n">buildings</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"----- Result -----"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="o">:</span> <span class="n">ans</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"["</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">"], "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">TestSkyline6</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"===== TestSkyline6 ====="</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">infile</span><span class="p">(</span><span class="s">"test_input"</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">buildings</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">infile</span><span class="p">.</span><span class="n">eof</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">infile</span> <span class="o">&gt;&gt;</span> <span class="n">x1</span> <span class="o">&gt;&gt;</span> <span class="n">x2</span> <span class="o">&gt;&gt;</span> <span class="n">y</span><span class="p">;</span>
      <span class="n">buildings</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="p">});</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"input length: "</span> <span class="o">&lt;&lt;</span> <span class="n">buildings</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">ans</span><span class="p">;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">getSkyline</span><span class="p">(</span><span class="n">buildings</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"----- Result -----"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="o">:</span> <span class="n">ans</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"["</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">"], "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">GenerateRandomInput</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">mt19937</span><span class="o">&amp;</span> <span class="n">gen</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">uniform_int_distribution</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dist_x</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">uniform_int_distribution</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dist_y</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">buildings</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
      <span class="n">x1</span> <span class="o">=</span> <span class="n">dist_x</span><span class="p">(</span><span class="n">gen</span><span class="p">);</span>
      <span class="n">x2</span> <span class="o">=</span> <span class="n">dist_x</span><span class="p">(</span><span class="n">gen</span><span class="p">);</span>
      <span class="n">y</span> <span class="o">=</span> <span class="n">dist_y</span><span class="p">(</span><span class="n">gen</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">x1</span> <span class="o">&gt;</span> <span class="n">x2</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">x1</span><span class="p">;</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x2</span><span class="p">;</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">x1</span> <span class="o">==</span> <span class="n">x2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">buildings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="p">};</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">(</span><span class="n">buildings</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">buildings</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
    <span class="k">return</span> <span class="n">buildings</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="n">ProfileTC</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">repetition</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">random_device</span> <span class="n">rd</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">mt19937</span> <span class="n">gen</span><span class="p">(</span><span class="mi">1234</span><span class="p">);</span>  <span class="c1">// rd()</span>
    <span class="n">std</span><span class="o">::</span><span class="n">stringstream</span> <span class="n">ss</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="n">outfile</span><span class="p">(</span><span class="s">"profile"</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">scale</span> <span class="o">=</span> <span class="mi">20000000</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">scale</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">scale</span> <span class="o">*</span> <span class="mi">1</span><span class="p">;</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="n">scale</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">repetition</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">buildings</span> <span class="o">=</span> <span class="n">GenerateRandomInput</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">gen</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">begin</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">time_point</span> <span class="n">end</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">ans</span><span class="p">;</span>
        <span class="n">begin</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">GetSkylineSlow</span><span class="p">(</span><span class="n">buildings</span><span class="p">);</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

        <span class="kt">int</span> <span class="n">h1</span> <span class="o">=</span> <span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
        <span class="k">auto</span> <span class="n">time_ms1</span> <span class="o">=</span>
            <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">begin</span><span class="p">)</span>
                <span class="p">.</span><span class="n">count</span><span class="p">();</span>

        <span class="n">begin</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">getSkyline</span><span class="p">(</span><span class="n">buildings</span><span class="p">);</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
        <span class="k">auto</span> <span class="n">time_ms2</span> <span class="o">=</span>
            <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">begin</span><span class="p">)</span>
                <span class="p">.</span><span class="n">count</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">h1</span> <span class="o">==</span> <span class="n">h2</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">h</span> <span class="o">=</span> <span class="n">h1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">outfile</span> <span class="o">&lt;&lt;</span> <span class="s">"----- Error ----- : "</span> <span class="o">&lt;&lt;</span> <span class="n">h1</span> <span class="o">&lt;&lt;</span> <span class="s">" vs "</span> <span class="o">&lt;&lt;</span> <span class="n">h2</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
          <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">b</span> <span class="o">:</span> <span class="n">buildings</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">outfile</span> <span class="o">&lt;&lt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">outfile</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">h</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">time_ms1</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">time_ms2</span>
                <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// outfile &lt;&lt; ss.rdbuf();</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Solution</span> <span class="n">s</span><span class="p">;</span>
  <span class="c1">// s.TestTree();</span>
  <span class="c1">// s.TestQuery();</span>
  <span class="c1">// s.TestQuery2();</span>
  <span class="c1">// s.TestQuery3();</span>
  <span class="c1">// s.TestSlow();</span>
  <span class="c1">// s.TestSlow2();</span>
  <span class="c1">// s.TestSlow3();</span>
  <span class="c1">// s.TestSkyline();</span>
  <span class="c1">// s.TestSkyline2();</span>
  <span class="c1">// s.TestSkyline3();</span>
  <span class="c1">// s.TestSkyline4();</span>
  <span class="c1">// s.TestSkyline5();</span>
  <span class="c1">// s.TestSkyline6();</span>
  <span class="n">s</span><span class="p">.</span><span class="n">ProfileTC</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

</details>

<details>
<summary>시각화 코드</summary>


<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Rectangle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1"># 10^4
</span><span class="k">def</span> <span class="nf">generate_random_case</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="c1"># buildings = [[1,2**5, 2**5]]
</span>    <span class="n">buildings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">10</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">10</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">x_max</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="n">x2</span><span class="p">:</span> 
            <span class="n">x1</span><span class="p">,</span><span class="n">x2</span> <span class="o">=</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x1</span>
        <span class="k">elif</span> <span class="n">x1</span> <span class="o">==</span> <span class="n">x2</span><span class="p">:</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">x2</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">buildings</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
    <span class="n">buildings</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">buildings</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">buildings</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span>

    

    <span class="c1"># buildings = [[1,38,219],[2,19,228],[2,64,106],[3,80,65],[3,84,8],[4,12,8],[4,25,14],[4,46,225],[4,67,187],[5,36,118],[5,48,211],[5,55,97],[6,42,92],[6,56,188],[7,37,42],[7,49,78],[7,84,163],[8,44,212],[9,42,125],[9,85,200],[9,100,74],[10,13,58],[11,30,179],[12,32,215],[12,33,161],[12,61,198],[13,38,48],[13,65,222],[14,22,1],[15,70,222],[16,19,196],[16,24,142],[16,25,176],[16,57,114],[18,45,1],[19,79,149],[20,33,53],[21,29,41],[23,77,43],[24,41,75],[24,94,20],[27,63,2],[31,69,58],[31,88,123],[31,88,146],[33,61,27],[35,62,190],[35,81,116],[37,97,81],[38,78,99],[39,51,125],[39,98,144],[40,95,4],[45,89,229],[47,49,10],[47,99,152],[48,67,69],[48,72,1],[49,73,204],[49,77,117],[50,61,174],[50,76,147],[52,64,4],[52,89,84],[54,70,201],[57,76,47],[58,61,215],[58,98,57],[61,95,190],[66,71,34],[66,99,53],[67,74,9],[68,97,175],[70,88,131],[74,77,155],[74,99,145],[76,88,26],[82,87,40],[83,84,132],[88,99,99]]
</span>    <span class="n">buildings</span> <span class="o">=</span> <span class="n">generate_random_case</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="c1"># print(buildings)
</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"test_input_py"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">buildings</span><span class="p">))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"test_input"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buildings</span><span class="p">))</span>

    
    <span class="n">x_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">])</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">])</span>

    <span class="n">ax</span><span class="p">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">x_max</span><span class="o">*</span><span class="mf">1.1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">y_max</span><span class="o">*</span><span class="mf">1.1</span><span class="p">])</span>
    <span class="c1"># ax.set_xticks(np.arange(-1, x_max, 100))
</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">cm</span><span class="p">.</span><span class="n">viridis</span>

    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">fill</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">))))</span>

    <span class="c1"># ans = [[1, 219], [2, 228], [19, 225], [45, 229], [89, 190], [95, 175], [97, 152], [99, 74], [100, 0]]
</span>    <span class="n">ans</span>  <span class="o">=</span> <span class="p">[[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">451</span><span class="p">],</span> <span class="p">[</span><span class="mi">103</span><span class="p">,</span> <span class="mi">773</span><span class="p">],</span> <span class="p">[</span><span class="mi">196</span><span class="p">,</span> <span class="mi">494</span><span class="p">],</span> <span class="p">[</span><span class="mi">360</span><span class="p">,</span> <span class="mi">1003</span><span class="p">],</span> <span class="p">[</span><span class="mi">551</span><span class="p">,</span> <span class="mi">893</span><span class="p">],</span> <span class="p">[</span><span class="mi">562</span><span class="p">,</span> <span class="mi">943</span><span class="p">],</span> <span class="p">[</span><span class="mi">808</span><span class="p">,</span> <span class="mi">288</span><span class="p">],</span> <span class="p">[</span><span class="mi">832</span><span class="p">,</span> <span class="mi">133</span><span class="p">],</span> <span class="p">[</span><span class="mi">973</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>

    <span class="n">ans_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">ans</span><span class="p">]</span>
    <span class="n">ans_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">ans</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ans_x</span><span class="p">,</span> <span class="n">ans_y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'red'</span><span class="p">)</span>

    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>

</details>


        </div>

        

        

        <script src="https://utteranc.es/client.js" repo="keechang-choi/keechang-choi.github.io" issue-term="pathname" theme="github-light" label="Comment" crossorigin="anonymous" async>
          </script>

        <nav class="page-pagination" role="navigation">
  
    <a class="page-previous" href="/study/study-vge-pbd/">
      <h4 class="page-pagination-label">Previous</h4>
      <span class="page-pagination-title">
        <i class="fas fa-arrow-left"></i> Vulkan Graphics Examples - PBD

      </span>
    </a>
  

  
    <a class="page-next" href="/study/study-vge-cloth/">
      <h4 class="page-pagination-label">Next</h4>
      <span class="page-pagination-title">
        Vulkan Graphics Examples - Cloth
 <i class="fas fa-arrow-right"></i>
      </span>
    </a>
  
</nav>

      </div>
    </div>
  </article>
</main>

    <footer id="footer" class="site-footer">
  <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
<div class="social-icons"><a class="social-icon" href="/atom.xml"><i class="fas fa-rss-square fa-2x" title="Feed"></i></a></div>
<div class="copyright">
    
      <p>© 2024 KC blog. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/mmistakes/so-simple-theme" rel="nofollow">So Simple</a>.</p>
    
  </div>
</footer>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>


<!-- MathJax -->

<script>
// http://docs.mathjax.org/en/latest/upgrading/v2.html
MathJax = {
  tex: {
      tags: "ams"    // eq numbering options: none, ams, all
  },
  options: {
    renderActions: {
      // for mathjax 3, handle <script "math/tex"> blocks inserted by kramdown
      find: [10, function (doc) {
        for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
          const display = !!node.type.match(/; *mode=display/);
          const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
          const text = document.createTextNode('');
          node.parentNode.replaceChild(text, node);
          math.start = {node: text, delim: '', n: 0};
          math.end = {node: text, delim: '', n: 0};
          doc.math.push(math);
        }
      }, '']
    }
  }
}
</script>

<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  </body>

</html>
